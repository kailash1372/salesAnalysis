<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <title>salesAnalyser</title>
</head>
<body>
    <div class="container d-flex justify-content-center">
        <div class="border border-dark rounded-2 text-center " style="margin-top:20px;padding: 10%;padding-top:3%;width:60%;">
            <h1 style="margin-top: 5px;padding-bottom: 0px;"><span style="color: red;">sales</span><span style="color: blue;">Analyser</span></h1><br/>
            <h3 id="headertext" style="padding-bottom: 7px;color: black;">Sign In</h3>
            <h6 class=" text-black">to continue to use salesAnalyser!</h6>
            <input id="companyname" class="border rounded-3 w-100 bg-light" type="text" placeholder="Enter Company Name" style="margin-top: 30px;padding: 10px;display:none;">
            <input id="email" class=" email border rounded-3 w-100 bg-light" type="email" placeholder="Enter Email" style="margin-top: 15px;padding: 10px;"><br/>
            <input id="password" class="password border rounded-3 w-100 bg-light"type="password" placeholder="Enter Password" style="margin-top:15px;padding:10px"><br/>
            <button id="signinbtn" class="btn btn-primary w-100 " style="margin-top: 7%;padding:10px;" onclick="signin()">Sign In</button>
            <h6 id="or" style="margin-top: 5px;margin-bottom: 5px;">--OR--</h6>
            <button id="signupbtn" class="btn btn-success w-100" style="margin-top: 10px;padding:10px;" onclick="signup()">Sign Up</button>
            <button id="gobackbtn" class="btn btn-secondary w-100" style="margin-top: 10px;padding:10px;display:none;" onclick="undosignup()">Go Back</button>
        </div>
    </div>
    



    <!-- This is the Section Where All the JavaScript is Written -->

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCMZHKLeMaNV5FX8USnq8ramPeq6Bx1YEc",
            authDomain: "salesanalyser-9a0b3.firebaseapp.com",
            projectId: "salesanalyser-9a0b3",
            storageBucket: "salesanalyser-9a0b3.appspot.com",
            messagingSenderId: "203125898322",
            appId: "1:203125898322:web:51ce6d9e4a7de4fe20338b"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>
    
    <!-- the script part for sign in -->
    <script>
        function signin(){
            var email = document.getElementById('email').value;
            var password = document.getElementById('password').value;

            auth.signInWithEmailAndPassword(email, password).then((cred) => {
                alert("sign in successful!");
                window.location.href = "./products.html";
            })
            .catch((error) => {
                var errorCode = error.code;
                var errorMessage = error.message;
                alert(errorMessage);
                clearPassword();
            });

            function clearPassword(){
                document.getElementById('password').value ="";
            }
            auth.onAuthStateChanged((user) => {
                if (user) {
                    var u = user.uid;
                    sessionStorage.setItem('uid', JSON.stringify(u));
                }
            });
        }
    </script>


    <!-- This Is the Script for Sign Up and Register! -->
    <script>
        var decide=0;
        
        function signup(){
            if(decide!=0)register();
            else{
                document.getElementById('headertext').innerHTML="Register";
                document.getElementById('signupbtn').innerHTML="Register";
                document.getElementById('signinbtn').style.display="none";
                document.getElementById('or').style.display="none";
                document.getElementById('gobackbtn').style.display="block";
                document.getElementById('companyname').style.display="block";
                decide=1;
            }
        }

        function clearFields(){
            document.getElementById('companyname').value="";
            document.getElementById('email').value ="";
            document.getElementById('password').value ="";
        }

        function undosignup(){
            document.getElementById('headertext').innerHTML="Sign In";
            document.getElementById('signupbtn').innerHTML="Sign Up";
            document.getElementById('signinbtn').style.display="block";
            document.getElementById('or').style.display="block";
            document.getElementById('gobackbtn').style.display="none";
            document.getElementById('companyname').style.display="none";
            decide=0;
        }

        function register(){
            var companyName = document.getElementById('companyname').value;
            var email = document.getElementById('email').value;
            var password = document.getElementById('password').value;

            auth.setPersistence(firebase.auth.Auth.Persistence.NONE)
            .then(() => {
                return auth.createUserWithEmailAndPassword(email, password);
            })
            .then((cred) => {
                const uid = cred.user.uid;
                alert("You have been signed up!");
                clearFields();
                undosignup();
                db.collection("users").doc(uid).set({ companyName: companyName }, { merge: true });
            })
            .catch((error) => {
                var errorMessage = error.message;
                alert(errorMessage);
            });

        }        
    </script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
</body>
</html>