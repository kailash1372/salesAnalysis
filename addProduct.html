<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <title>Add Products</title>
</head>
<body>
    <label>Name:</label><br/>
    <input id="pname" type="text" placeholder="Enter Product Name"><br/><br/>
    <label>FixedCosts:</label><br/>
    <input id="fc" type="text" placeholder="Enter Details here.."><br/><br/>
    <label>VariableCosts:</label><br/>
    <input id="vc" type="text" placeholder="Enter Details here.."><br/><br/>

    <button onclick="addProduct()">Add</button>


<!-- JavaScript from Here! -->

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCMZHKLeMaNV5FX8USnq8ramPeq6Bx1YEc",
            authDomain: "salesanalyser-9a0b3.firebaseapp.com",
            projectId: "salesanalyser-9a0b3",
            storageBucket: "salesanalyser-9a0b3.appspot.com",
            messagingSenderId: "203125898322",
            appId: "1:203125898322:web:51ce6d9e4a7de4fe20338b"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>

    <!-- getting uid from sessionStorage -->
    <script>
        const uid = JSON.parse(sessionStorage.getItem('uid'));
        // i used a uid directly since i didn't want to log in everytime i wanted to make changes to this page!
        console.log(uid);
        var ref = db.collection("users").doc(uid);
    </script>

    <script>
        async function addProduct() {
            try {
                var productname = document.getElementById('pname').value;
                var fixedcosts = document.getElementById('fc').value;
                var variablecosts = document.getElementById('vc').value;

                await ref.collection("allproducts").doc(productname).set(
                { fixedcosts: fixedcosts, variablecosts: variablecosts },
                { merge: true }
                );

                for (var i = 1; i <= 10; i++) {
                var fieldName = i.toString();
                var data = {};
                data[fieldName] = i;

                await ref
                    .collection("allproducts")
                    .doc(productname)
                    .collection("data")
                    .doc("jan")
                    .set(data, { merge: true });
                }

                window.location.href = "./products.html";
            } catch (error) {
                console.log("Error adding product: ", error);
            }
        }   
    </script>
    <!-- bootstrap js library -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
</body>
</html>